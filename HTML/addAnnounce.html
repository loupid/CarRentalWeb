<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Location de véhicule au Canada</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../CSS/styles.css" type="text/css">
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../JS/Main.js"></script>
    <script src="../JS/Get/ListOfCars.js"></script>
    <script src="../JS/RenderingManager.js"></script>
</head>
<body>
<script>
    function setImageText() {
        var imageFile = document.getElementById('image');
        debugger;
        $("#span_image_choice").text(imageFile.files.item(0).name);
    }

    $(document).ready(() => {
        $('#btn_confirm_add_announce').click(() => {
                let stringJsonInput = "{";
                $('div#form :input').serializeArray().forEach((e) => {
                    stringJsonInput += '"' + e.name + '":"' + e.value + '",';
                });
                stringJsonInput = stringJsonInput.substring(0, stringJsonInput.length - 1) + "}";
                let data = JSON.parse(stringJsonInput);
                debugger;
                var file_data = $('#image').prop('files')[0];
                data.filename = file_data.name;
                if (!data.filename){
                    data.filename = "Logo.png"
                }
                var form_data = new FormData();
                form_data.append('file', file_data);

                $.ajax('../Php/Upload.php',{
                    dataType: 'text',
                    cache: false,
                    contentType: false,
                    processData: false,
                    data: form_data,
                    type: 'post',
                    success: (e) => {
                        debugger;
                    }
                });

                if (!data.available){
                    data.available = "0";
                }
                else data.available = "1";
                $.ajax('../Php/AddAnnounce.php', {
                    type: 'post',
                    data: data,
                    success: (dataResult) => {
                        dataResult = JSON.parse(dataResult);
                        if (dataResult.statusCode === 200) {
                            window.location = '../index.html';
                            alert("Inscription réussi");
                        } else if (dataResult.statusCode === 201) {
                            alert("Erreur lors de l'enregistrement");
                        }
                    }
                });
        }
        );
    });

    function sendannounce(e){
        // let stringJsonInput = "{";
        // $('div#form :input').serializeArray().forEach((e) => {
        //     stringJsonInput += '"' + e.name + '":"' + e.value + '",';
        // });
        // stringJsonInput = stringJsonInput.substring(0, stringJsonInput.length - 1) + "}";
        // let data = JSON.parse(stringJsonInput);
        // debugger;
        // var file_data = $('#image').prop('files')[0];
        // data.filename = file_data.name;
        // if (!data.filename){
        //     data.filename = "Logo.png"
        // }
        // var form_data = new FormData();
        // form_data.append('file', file_data);

        debugger;
        let test = $('#form');
        var formData = JSON.stringify($("#Form").serializeArray());

        $.ajax('../Php/Upload.php',{
            dataType: 'text',
            cache: false,
            contentType: false,
            processData: false,
            data: form_data,
            type: 'post',
            success: (e) => {
                debugger;
            }
        });

        if (!data.available){
            data.available = "0";
        }
        else data.available = "1";
        $.ajax('../Php/AddAnnounce.php', {
            type: 'post',
            data: data,
            success: (dataResult) => {
                dataResult = JSON.parse(dataResult);
                if (dataResult.statusCode === 200) {
                    window.location = '../index.html';
                    alert("Ajout de l'annonce reussi");
                } else if (dataResult.statusCode === 201) {
                    alert("Erreur lors de l'enregistrement");
                }
            }
        });
    }
</script>
<header>
    <button type="submit" id="btn_burger" onclick="openNav()"><i id="icon_btn_burger" class="fas fa-bars"></i></button>
    <img class="logo" src="../Images/Logo.PNG" alt="logo">
    <div class="search">
        <input type="text" class="search_box" placeholder="Rechercher..."/>
        <button type="submit" id="btn_search"><i class="fa fa-search"></i></button>
    </div>
    <nav>
        <ul class="nav_links">
            <li><a id="about" href="#">À propos de nous</a></li>
            <li><a id="register" href="#">S'inscrire</a></li>
        </ul>
    </nav>
    <a id="connexion">
        <button id="btn_login">Se connecter</button>
    </a>
</header>
<form id="form" method="post" onsubmit="sendannounce(this)" on>
    <div class="add_announce">
        <div class="add_announce_container announce_details">
            <h1>Détails de l'annonce</h1>
            <hr>
            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-font icon" style="color: black"></i>
                <input class="field" type="text" id="title" name="title"
                       placeholder="Titre de l'annonce" required>
            </div>

            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-car icon" style="color: black"></i>
                <input class="field" type="text" id="brand" name="brand"
                       placeholder="Marque" required>
            </div>

            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-car-side icon" style="color: black"></i>
                <input class="field" type="text" id="model" name="model"
                       placeholder="Modèle" required>
            </div>

            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-th icon" style="color: black"></i>
                <input class="field" type="text" id="category" name="category"
                       placeholder="Catégorie" required>
            </div>

            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-users icon" style="color: black"></i>
                <input class="field" type="text" id="seat_count" name="seat_count" step="1" min="1"
                       placeholder="Nombre de passagers" required>
            </div>

            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-comment-alt icon" style="color: black"></i>
                <textarea name="description" class="field" id="description" rows="5" style="color: black" placeholder="Description" required></textarea>
            </div>

            <div class="add_announce_available">
                <div class="add_announce_available_text input_container">
                    <i class="fas fa-clipboard-check" id="icon_available" style="font-size: 25px"></i>
                    <h2>Disponible ?</h2>
                </div>
                <label class="register_switch">
                    <input type="checkbox" name="available">
                    <span class="register_slider round"></span>
                </label>
            </div>
        </div>

        <div class="add_announce_container announce_media">
            <h1>Médias</h1>
            <hr>
            <h3>Ajoutez une photo pour attirer l'attention sur votre annonce</h3>
            <div id="hide">
                <label class="hand-cursor">
                    <input type="file" id="image" accept="image/*" name="fileToUpload" onchange="setImageText()">
                    <span id="addimage">
                        <i class="fas fa-camera-retro icon" id="icon_camera" style="font-size: 25px"></i>
                        <span class="photo_text hidden-xs" id="span_image_choice">Choisir image</span>
                    </span>
                </label>
            </div>
        </div>

        <div class="add_announce_container announce_localisation">
            <h1>Emplacement</h1>
            <hr>
            <div class="input_container">
                <i class="fas fa-map-marked-alt icon"></i>
                <input class="field announce_input_city" type="text" id="announce_localisation" name="announce_localisation"
                       placeholder="Entrez une ville">
            </div>
        </div>

        <div class="add_announce_container announce_price">
            <h1>Prix</h1>
            <hr>
            <div class="input_container_addAnnounce input_container">
                <i class="fas fa-dollar-sign icon" style="color: black"></i>
                <input class="field" type="number" id="price" name="price"
                       placeholder="Prix par jour" min="0.01" step="0.01" required>
            </div>
        </div>
        <button type="submit" id="btn_confirm_add_announce">Publier l'annonce</button>
    </div>
</form>
</body>
</html>
